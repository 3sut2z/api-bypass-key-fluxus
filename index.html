<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* CSS */
html {
  height: 100%;
  width: 100%;
}
</style>
</head>
<body>

<script>
async function getfluxuskey(link) {
    try {
        const response = await fetch(`https://132.145.68.135:6056/?url=${link}`);
        const json = await response.json();

        if (json.status === "success") {
            return json.key;
        } else {
            throw new Error('Failed to retrieve key');
        }
    } catch (error) {
        console.error('Error:', error);
        return null;
    }
}

async function handleRequest() {
    var urlParams = new URLSearchParams(window.location.search);
    var url = urlParams.get('url');

    if (!url) {
        var failResponse = {
            "status": "fail",
            "error": "No URL Provided."
        };
        return { response: JSON.stringify(failResponse), isFail: true };
    }

    if (url.startsWith("https://flux.li/android/external/start.php?HWID=")) {
        var key = await getfluxuskey(url);
        if (key) {
            var response = {
                "status": "success",
                "key": key,
            };
            return { response: JSON.stringify(response), isFail: false };
        } else {
            var failResponse = {
                "status": "fail",
                "error": "Unable to retrieve key."
            };
            return { response: JSON.stringify(failResponse), isFail: true };
        }
    } else {
        var failResponse = {
            "status": "fail",
            "error": "Invalid URL."
        };
        return { response: JSON.stringify(failResponse), isFail: true };
    }
}

window.onload = async function() {
    var result = await handleRequest();
    var response = result.response;
    var isFail = result.isFail;
    
    var responseContainer = document.createElement('pre');
    responseContainer.className = isFail ? 'fail-response' : 'response';
    responseContainer.textContent = response;
    document.body.appendChild(responseContainer);
};
</script>

</body>
</html>
